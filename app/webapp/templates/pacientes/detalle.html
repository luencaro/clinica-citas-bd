{% extends 'base.html' %}

{% block title %}Detalle Paciente - Clínica{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-person-fill"></i> Información del Paciente</h2>
        <a href="{% url 'pacientes_list' %}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Volver
        </a>
    </div>

    <div class="row">
        <!-- Datos Personales -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-person-badge"></i> Datos Personales</h5>
                </div>
                <div class="card-body">
                    <p><strong>ID Paciente:</strong> {{ paciente.id_paciente }}</p>
                    <p><strong>Nombre:</strong>
                        {% if paciente.usuario %}
                        {{ paciente.usuario.nombre }} {{ paciente.usuario.apellido }}
                        {% else %}
                        N/A
                        {% endif %}
                    </p>
                    <p><strong>Fecha de Nacimiento:</strong> {{ paciente.fecha_nacimiento|date:"d/m/Y" }}</p>
                    <p><strong>Género:</strong>
                        {% if paciente.genero == 'M' %}
                        Masculino
                        {% elif paciente.genero == 'F' %}
                        Femenino
                        {% else %}
                        Otro
                        {% endif %}
                    </p>
                    <p><strong>Dirección:</strong> {{ paciente.direccion|default:"No especificada" }}</p>
                </div>
            </div>
        </div>

        <!-- Datos de Contacto -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-telephone"></i> Contacto</h5>
                </div>
                <div class="card-body">
                    {% if paciente.usuario %}
                    <p><strong>Email:</strong> {{ paciente.usuario.email }}</p>
                    <p><strong>Teléfono:</strong> {{ paciente.usuario.telefono }}</p>
                    {% else %}
                    <p class="text-muted">No hay datos de contacto disponibles</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Historial de Citas -->
    <div class="card">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0"><i class="bi bi-calendar-check"></i> Historial de Citas</h5>
        </div>
        <div class="card-body">
            {% if citas %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Hora</th>
                            <th>Médico</th>
                            <th>Especialidad</th>
                            <th>Estado</th>
                            <th>Motivo</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cita in citas %}
                        <tr>
                            <td>{{ cita.fecha_hora|date:"d/m/Y" }}</td>
                            <td>{{ cita.fecha_hora|time:"H:i" }}</td>
                            <td>
                                {% if cita.medico and cita.medico.usuario %}
                                Dr. {{ cita.medico.usuario.nombre }} {{ cita.medico.usuario.apellido }}
                                {% else %}
                                N/A
                                {% endif %}
                            </td>
                            <td>
                                {% if cita.medico and cita.medico.especialidad %}
                                {{ cita.medico.especialidad.nombre }}
                                {% else %}
                                N/A
                                {% endif %}
                            </td>
                            <td>
                                {% if cita.estado == 'PENDIENTE' %}
                                <span class="badge bg-warning">Pendiente</span>
                                {% elif cita.estado == 'CONFIRMADA' %}
                                <span class="badge bg-info">Confirmada</span>
                                {% elif cita.estado == 'COMPLETADA' %}
                                <span class="badge bg-success">Completada</span>
                                {% elif cita.estado == 'CANCELADA' %}
                                <span class="badge bg-danger">Cancelada</span>
                                {% else %}
                                <span class="badge bg-secondary">{{ cita.estado }}</span>
                                {% endif %}
                            </td>
                            <td>{{ cita.motivo_consulta|truncatewords:5 }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted">No hay citas registradas para este paciente.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}